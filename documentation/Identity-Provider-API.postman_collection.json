{
  "info": {
    "name": "Identity Provider API",
    "description": "Collection Postman pour tester l'API Identity Provider.\n\nInstructions :\n1. Lancer le backend : cd identity-provider && docker-compose up -d --build\n2. Exécuter Health Check pour vérifier\n3. Register pour créer un utilisateur\n4. Login pour obtenir le token JWT (enregistré automatiquement)\n5. Utiliser les autres endpoints",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080/api"
    },
    {
      "key": "token",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "System",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Vérifier que l'API est en marche"
          }
        },
        {
          "name": "API Docs",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/docs",
              "host": ["{{base_url}}"],
              "path": ["docs"]
            },
            "description": "Lien vers la documentation Swagger"
          }
        }
      ]
    },
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Register",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@example.com\",\n    \"password\": \"Password123!\",\n    \"first_name\": \"Test\",\n    \"last_name\": \"User\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/register",
              "host": ["{{base_url}}"],
              "path": ["auth", "register"]
            },
            "description": "Créer un nouvel utilisateur"
          }
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.token) {",
                  "    pm.collectionVariables.set('token', jsonData.data.token);",
                  "    console.log('Token saved: ' + jsonData.data.token);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@example.com\",\n    \"password\": \"Password123!\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "Se connecter et récupérer le token JWT. Le token est automatiquement enregistré dans la variable {{token}}."
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.token) {",
                  "    pm.collectionVariables.set('token', jsonData.data.token);",
                  "    console.log('Token refreshed: ' + jsonData.data.token);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/auth/refresh",
              "host": ["{{base_url}}"],
              "path": ["auth", "refresh"]
            },
            "description": "Rafraîchir le token JWT"
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/auth/logout",
              "host": ["{{base_url}}"],
              "path": ["auth", "logout"]
            },
            "description": "Se déconnecter (invalider le token)"
          }
        }
      ]
    },
    {
      "name": "User Profile",
      "item": [
        {
          "name": "Get Profile",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/user/profile",
              "host": ["{{base_url}}"],
              "path": ["user", "profile"]
            },
            "description": "Récupérer le profil de l'utilisateur connecté"
          }
        },
        {
          "name": "Update Profile",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"first_name\": \"Nouveau\",\n    \"last_name\": \"Nom\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/user/profile",
              "host": ["{{base_url}}"],
              "path": ["user", "profile"]
            },
            "description": "Modifier le profil de l'utilisateur"
          }
        },
        {
          "name": "Delete Account",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/user/account",
              "host": ["{{base_url}}"],
              "path": ["user", "account"]
            },
            "description": "Supprimer le compte utilisateur"
          }
        }
      ]
    },
    {
      "name": "Signalements",
      "item": [
        {
          "name": "Get All Signalements",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/signalements",
              "host": ["{{base_url}}"],
              "path": ["signalements"]
            },
            "description": "Récupérer tous les signalements (PUBLIC, pas besoin d'auth)"
          }
        },
        {
          "name": "Create Signalement",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"latitude\": -18.879200,\n    \"longitude\": 47.507900,\n    \"description\": \"Nid de poule sur la route principale\",\n    \"status\": \"nouveau\",\n    \"surface\": 50,\n    \"niveau\": 3\n}"
            },
            "url": {
              "raw": "{{base_url}}/signalements",
              "host": ["{{base_url}}"],
              "path": ["signalements"]
            },
            "description": "Créer un nouveau signalement de dégradation routière"
          }
        },
        {
          "name": "Get Signalement By ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/signalements/1",
              "host": ["{{base_url}}"],
              "path": ["signalements", "1"]
            },
            "description": "Récupérer un signalement par son ID"
          }
        },
        {
          "name": "Update Signalement",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"description\": \"Nid de poule réparé partiellement\",\n    \"surface\": 30,\n    \"niveau\": 5,\n    \"entreprise\": \"Entreprise X\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/signalements/1",
              "host": ["{{base_url}}"],
              "path": ["signalements", "1"]
            },
            "description": "Modifier un signalement existant"
          }
        },
        {
          "name": "Update Signalement Status",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"status\": \"en_cours\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/signalements/1/status",
              "host": ["{{base_url}}"],
              "path": ["signalements", "1", "status"]
            },
            "description": "Changer le statut d'un signalement (nouveau → en_cours → termine)"
          }
        },
        {
          "name": "Delete Signalement",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/signalements/1",
              "host": ["{{base_url}}"],
              "path": ["signalements", "1"]
            },
            "description": "Supprimer un signalement"
          }
        }
      ]
    },
    {
      "name": "Statistics",
      "item": [
        {
          "name": "Get Stats",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/stats",
              "host": ["{{base_url}}"],
              "path": ["stats"]
            },
            "description": "Obtenir les statistiques des signalements"
          }
        },
        {
          "name": "Get Delay Stats",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/stats/delays",
              "host": ["{{base_url}}"],
              "path": ["stats", "delays"]
            },
            "description": "Obtenir les statistiques de délais de traitement"
          }
        }
      ]
    },
    {
      "name": "Settings",
      "item": [
        {
          "name": "Get Settings",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/settings",
              "host": ["{{base_url}}"],
              "path": ["settings"]
            },
            "description": "Récupérer tous les paramètres"
          }
        },
        {
          "name": "Update Setting (Manager)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"value\": \"7500\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/settings/prix_par_m2",
              "host": ["{{base_url}}"],
              "path": ["settings", "prix_par_m2"]
            },
            "description": "Modifier un paramètre (réservé aux managers)"
          }
        }
      ]
    },
    {
      "name": "Admin",
      "item": [
        {
          "name": "Unlock User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@example.com\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/unlock-user",
              "host": ["{{base_url}}"],
              "path": ["admin", "unlock-user"]
            },
            "description": "Débloquer un compte verrouillé suite à trop de tentatives de connexion"
          }
        },
        {
          "name": "Create User (Admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"newuser@example.com\",\n    \"password\": \"Password123!\",\n    \"first_name\": \"Nouveau\",\n    \"last_name\": \"Utilisateur\",\n    \"role\": \"user\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/users/create",
              "host": ["{{base_url}}"],
              "path": ["admin", "users", "create"]
            },
            "description": "Créer un utilisateur en tant qu'administrateur"
          }
        },
        {
          "name": "Get All Users (Admin)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/admin/users",
              "host": ["{{base_url}}"],
              "path": ["admin", "users"]
            },
            "description": "Récupérer la liste de tous les utilisateurs"
          }
        },
        {
          "name": "Update User Role",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"role\": \"manager\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/users/1/role",
              "host": ["{{base_url}}"],
              "path": ["admin", "users", "1", "role"]
            },
            "description": "Changer le rôle d'un utilisateur (user / manager)"
          }
        }
      ]
    },
    {
      "name": "Sync",
      "item": [
        {
          "name": "Sync with Firebase",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/sync/firebase",
              "host": ["{{base_url}}"],
              "path": ["sync", "firebase"]
            },
            "description": "Synchroniser les données avec Firebase"
          }
        }
      ]
    }
  ]
}
